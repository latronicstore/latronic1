<!-- admin.html con persistencia en localStorage -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Panel - LaTRONIC</title>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  font-family: 'Josefin Sans', sans-serif;
  background: #121212;
  color: #ffffffcb;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
#login-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
}
#login-box {
  background: #1f1f1f;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 0 10px #e28f2f;
}
#login-box input {
  padding: 10px;
  margin: 10px 0;
  width: 200px;
  border-radius: 5px;
  border: none;
}
#login-box button {
  padding: 10px 20px;
  background: #e28f2f;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}
#admin-panel {
  display: none;
  padding: 20px;
  flex: 1;
}
#admin-panel h1 {
  color: #e28f2f;
}
#logout-btn {
  background: #e28f2f;
  color: black;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
  margin-bottom: 20px;
}
#form-producto input, 
#form-producto textarea {
  width: 100%;
  max-width: 400px;
  padding: 8px;
  margin: 5px 0;
  border-radius: 5px;
  border: none;
  background: #1f1f1f;
  color: #fff;
}
#form-producto button {
  padding: 10px 20px;
  background: #e28f2f;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 10px;
}
.productos {
  margin-top: 20px;
}
.producto {
  background: #1f1f1f;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 10px;
  box-shadow: 0 0 5px #e28f2f;
}
.producto h3 {
  margin: 0 0 5px 0;
  color: #e28f2f;
}
.producto img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  margin-right: 10px;
  border-radius: 5px;
}
.producto .mini-images {
  display: flex;
  margin-bottom: 10px;
}
.producto p {
  margin: 3px 0;
}
.producto input[type="number"] {
  width: 80px;
  background: #121212;
  color: #fff;
  border: 1px solid #e28f2f;
  border-radius: 5px;
  padding: 2px 5px;
}
.producto button {
  margin-top: 5px;
  margin-right: 5px;
  padding: 5px 10px;
  background: #e28f2f;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  color: black;
}

#go-shop-btn {
  background: transparent;
  border: 1px solid #e28f2f;
  color: #e28f2f;
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}
#go-shop-btn:hover {
  background: #e28f2f;
  color: black;
}

.title5{
    font-size: 10px;
    color:red;
    margin: 0;
}

</style>
</head>
<body>

<div id="login-screen">
  <div id="login-box">
    <h1>üîí Admin Access</h1>
    <h6 class="title5">This site is only for the administrator</h6>
    <input type="password" id="admin-password" placeholder="Enter Password" />
    <button id="login-btn">Enter</button>
  </div>
</div>

<div id="admin-panel">
  <div style="display:flex; gap:10px; margin-bottom:20px;">
  <button id="logout-btn">Logout</button>
  <button id="go-shop-btn">Go to Shop üõçÔ∏è</button>
</div>
<h1>Admin Panel</h1>


  <form id="form-producto">
    <input type="text" id="titulo" placeholder="T√≠tulo del producto" required />
    <textarea id="description" placeholder="Descripci√≥n" required></textarea>
    <input type="text" id="imagenes" placeholder="URLs separadas por coma" required />
    <input type="text" id="mainCat" placeholder="Categor√≠a principal" required />
    <input type="text" id="subCat" placeholder="Subcategor√≠a" required />
    <input type="number" id="price" placeholder="Precio" required />
    <input type="number" id="stock" placeholder="Stock" required />
    <button type="submit">Agregar producto</button>
  </form>

  <div class="productos" id="lista-productos"></div>
</div>

<script>
const ADMIN_PASSWORD = "161824"; // Cambia esta contrase√±a seg√∫n sea necesario
const loginScreen = document.getElementById("login-screen");
const adminPanel = document.getElementById("admin-panel");
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const goShopBtn = document.getElementById("go-shop-btn");
goShopBtn.addEventListener("click", () => {
  window.location.href = "shop.html";
});

const passwordInput = document.getElementById("admin-password");
const listaProductos = document.getElementById("lista-productos");
const formProducto = document.getElementById("form-producto");

// Productos en memoria / localStorage
let productos = [];

// LOGIN
loginBtn.addEventListener("click", () => {
  if(passwordInput.value === ADMIN_PASSWORD){
    loginScreen.style.display = "none";
    adminPanel.style.display = "block";
    cargarProductos();
  } else alert("‚ùå Contrase√±a incorrecta");
});

logoutBtn.addEventListener("click", () => {
  loginScreen.style.display = "flex";
  adminPanel.style.display = "none";
});

// Cargar productos desde localStorage o db.json
async function cargarProductos(){
  const stored = localStorage.getItem("productos");
  if(stored){
    productos = JSON.parse(stored);
  } else {
    try {
      const res = await fetch("db.json");
      productos = await res.json();
      localStorage.setItem("productos", JSON.stringify(productos));
    } catch(err){
      console.error("Error cargando productos:", err);
      productos = [];
    }
  }
  renderProductos();
}

// Guardar cambios en localStorage
function guardarProductos(){
  localStorage.setItem("productos", JSON.stringify(productos));
}

// Renderizar productos
function renderProductos(){
  listaProductos.innerHTML = "";
  productos.forEach(p => {
    const div = document.createElement("div");
    div.className = "producto";

    const miniImgs = document.createElement("div");
    miniImgs.className = "mini-images";
    p.imagenes.forEach(url=>{
      const img = document.createElement("img");
      img.src = url;
      miniImgs.appendChild(img);
    });
    div.appendChild(miniImgs);

    div.innerHTML += `
      <h3>${p.titulo}</h3>
      <p>${p.description}</p>
      <p>Categoria: ${p.categoria.main} / ${p.categoria.sub}</p>
      <p>Precio: <input type="number" value="${p.price}" id="price-${p.id}" /></p>
      <p>Stock: <input type="number" value="${p.stock}" id="stock-${p.id}" /></p>
      <button onclick="actualizarProducto('${p.id}')">Guardar</button>
      <button onclick="eliminarProducto('${p.id}')">Eliminar</button>
    `;
    listaProductos.appendChild(div);
  });
}

// Actualizar producto
window.actualizarProducto = function(id){
  const prod = productos.find(p=>p.id===id);
  if(!prod) return;
  prod.price = Number(document.getElementById(`price-${id}`).value);
  prod.stock = Number(document.getElementById(`stock-${id}`).value);
  guardarProductos();
  renderProductos();
}

// Eliminar producto
window.eliminarProducto = function(id){
  if(!confirm("¬øSeguro que quieres eliminar este producto?")) return;
  productos = productos.filter(p=>p.id!==id);
  guardarProductos();
  renderProductos();
}

// Agregar producto
formProducto.addEventListener("submit", e=>{
  e.preventDefault();
  const nuevo = {
    id: "prod-" + Date.now(),
    titulo: document.getElementById("titulo").value,
    description: document.getElementById("description").value,
    imagenes: document.getElementById("imagenes").value.split(",").map(s=>s.trim()),
    categoria:{
      main: document.getElementById("mainCat").value,
      sub: document.getElementById("subCat").value
    },
    price: Number(document.getElementById("price").value),
    stock: Number(document.getElementById("stock").value)
  };
  productos.push(nuevo);
  guardarProductos();
  formProducto.reset();
  renderProductos();
});
</script>
</body>
</html>
