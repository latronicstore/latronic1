<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
  /* --- RESET B√ÅSICO --- */
  * { box-sizing: border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
  body { background:#1e1e1e; color:#fff; }

  /* --- LOGIN --- */
  #login-screen { display:flex; justify-content:center; align-items:center; height:100vh; background:#111; }
  #login-box { background:#2a2a2a; padding:30px; border-radius:10px; text-align:center; width:90%; max-width:350px; }
  #login-box input, #login-box button { width:100%; padding:10px; margin:8px 0; border:none; border-radius:5px; font-size:1rem; }
  #login-box button { background:#e28f2f; color:#000; font-weight:bold; cursor:pointer; }

  /* --- PANEL ADMIN --- */
  #admin-panel { display:none; padding:20px; max-width:1200px; margin:0 auto; }
  #admin-panel h1 { margin-bottom:15px; }

  #form-producto input, #form-producto textarea, #form-producto button {
    width:100%; padding:10px; margin-bottom:10px; border:none; border-radius:5px; font-size:1rem;
  }
  #form-producto input, #form-producto textarea { background:#2a2a2a; color:#fff; }
  #form-producto button { background:#e28f2f; color:#000; font-weight:bold; cursor:pointer; }

  /* --- SEARCH --- */
  #search-input { 
    width:100%; padding:10px; margin-bottom:15px; border-radius:5px; border:none; font-size:1rem; 
    background:#2a2a2a; color:#fff; outline:none; transition: all 0.3s ease;
  }
  #search-input:focus { box-shadow:0 0 10px #e28f2f; }

  /* --- PRODUCTOS --- */
  .productos { display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:15px; }
  .producto { background:#2a2a2a; padding:15px; border-radius:10px; transition: transform 0.2s ease; position:relative; }
  .producto:hover { transform:scale(1.03); }
  .producto img { width:50px; height:50px; object-fit:cover; margin-right:5px; border-radius:4px; }
  .mini-images { display:flex; margin-bottom:10px; }
  .producto h3 { font-size:1.1rem; margin-bottom:5px; }
  .producto p { font-size:0.9rem; margin-bottom:5px; }
  .producto input { width:80px; background:#1e1e1e; color:#fff; border-radius:4px; padding:5px; }
  .producto button { margin-right:5px; margin-top:5px; background:#e28f2f; color:#000; border:none; border-radius:5px; padding:6px 10px; cursor:pointer; font-weight:bold; }

  /* --- MENSAJE GUARDADO --- */
  #mensaje-guardado {
    position:fixed; top:20px; right:20px; background:#28a745; color:#000;
    padding:10px 15px; border-radius:6px; display:none; font-weight:bold; box-shadow:0 2px 6px rgba(0,0,0,0.4);
    transition: all 0.3s ease;
  }

  /* --- BOTONES ARRIBA --- */
  .top-buttons { display:flex; gap:10px; margin-bottom:20px; }
  .top-buttons button { padding:10px 15px; border:none; border-radius:5px; background:#e28f2f; color:#000; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div id="login-box">
    <h1>üîí Admin Access</h1>
    <h6>This site is only for the administrator</h6>
    <input type="password" id="admin-password" placeholder="Enter Password" />
    <button id="login-btn">Enter</button>
  </div>
</div>

<!-- PANEL ADMIN -->
<div id="admin-panel">
  <div class="top-buttons">
    <button id="logout-btn">Logout</button>
    <button id="go-shop-btn">Go to Shop üõçÔ∏è</button>
  </div>

  <h1>Admin Panel</h1>

  <!-- SEARCH -->
  <input type="text" id="search-input" placeholder="Search products..." />

  <!-- FORM AGREGAR PRODUCTO -->
  <form id="form-producto">
    <input type="text" id="titulo" placeholder="T√≠tulo del producto" required />
    <textarea id="description" placeholder="Descripci√≥n" required></textarea>
    <input type="text" id="imagenes" placeholder="URLs separadas por coma" required />
    <input type="text" id="mainCat" placeholder="Categor√≠a principal" required />
    <input type="text" id="subCat" placeholder="Subcategor√≠a" required />
    <input type="number" id="price" placeholder="Precio" required />
    <input type="number" id="stock" placeholder="Stock" required />
    <button type="submit">Agregar producto</button>
  </form>

  <div class="productos" id="lista-productos"></div>
</div>

<!-- MENSAJE GUARDADO -->
<div id="mensaje-guardado">‚úÖ Cambios guardados correctamente</div>

<script>
const ADMIN_PASSWORD = "161824";
const loginScreen = document.getElementById("login-screen");
const adminPanel = document.getElementById("admin-panel");
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const goShopBtn = document.getElementById("go-shop-btn");
const passwordInput = document.getElementById("admin-password");
const listaProductos = document.getElementById("lista-productos");
const formProducto = document.getElementById("form-producto");
const mensajeGuardado = document.getElementById("mensaje-guardado");
const searchInput = document.getElementById("search-input");

let productos = [];

// LOGIN
loginBtn.addEventListener("click", () => {
  if(passwordInput.value === ADMIN_PASSWORD){
    loginScreen.style.display = "none";
    adminPanel.style.display = "block";
    cargarProductos();
  } else alert("‚ùå Contrase√±a incorrecta");
});

logoutBtn.addEventListener("click", () => {
  loginScreen.style.display = "flex";
  adminPanel.style.display = "none";
});

goShopBtn.addEventListener("click", () => window.location.href = "shop.html");

// Cargar productos
async function cargarProductos() {
  const stored = localStorage.getItem("productos");
  if (stored) productos = JSON.parse(stored);
  else {
    try {
      const res = await fetch("https://latronic.onrender.com/api/productos", { cache: "no-store" });
      productos = await res.json();
      localStorage.setItem("productos", JSON.stringify(productos));
    } catch (err) { productos = []; console.error(err); }
  }
  renderProductos();
}

// Guardar cambios y disparar evento storage
function guardarProductos(){
  localStorage.setItem("productos", JSON.stringify(productos));
  window.dispatchEvent(new Event("storage"));
}

// Mostrar mensaje guardado
function mostrarMensaje() {
  mensajeGuardado.style.display = "block";
  setTimeout(() => mensajeGuardado.style.display = "none", 2000);
}

// Renderizar productos
function renderProductos(filter=""){
  listaProductos.innerHTML = "";
  const filtrados = productos.filter(p => p.titulo.toLowerCase().includes(filter.toLowerCase()));
  filtrados.forEach(p => {
    const div = document.createElement("div");
    div.className = "producto";

    const miniImgs = document.createElement("div");
    miniImgs.className = "mini-images";
    p.imagenes.forEach(url=>{
      const img = document.createElement("img");
      img.src = url;
      miniImgs.appendChild(img);
    });
    div.appendChild(miniImgs);

    div.innerHTML += `
      <h3>${p.titulo}</h3>
      <p>${p.description}</p>
      <p>Categoria: ${p.categoria.main} / ${p.categoria.sub}</p>
      <p>Precio: <input type="number" value="${p.price}" id="price-${p.id}" /></p>
      <p>Stock: <input type="number" value="${p.stock}" id="stock-${p.id}" /></p>
      <button onclick="actualizarProducto('${p.id}')">Guardar</button>
      <button onclick="eliminarProducto('${p.id}')">Eliminar</button>
    `;
    listaProductos.appendChild(div);
  });
}

// Actualizar producto
window.actualizarProducto = function(id){
  const prod = productos.find(p=>p.id===id);
  if(!prod) return;
  prod.price = Number(document.getElementById(`price-${id}`).value);
  prod.stock = Number(document.getElementById(`stock-${id}`).value);
  guardarProductos();
  mostrarMensaje();
  renderProductos(searchInput.value);
}

// Eliminar producto
window.eliminarProducto = function(id){
  if(!confirm("¬øSeguro que quieres eliminar este producto?")) return;
  productos = productos.filter(p=>p.id!==id);
  guardarProductos();
  renderProductos(searchInput.value);
}

// Agregar producto
formProducto.addEventListener("submit", e=>{
  e.preventDefault();
  const nuevo = {
    id: "prod-" + Date.now(),
    titulo: document.getElementById("titulo").value,
    description: document.getElementById("description").value,
    imagenes: document.getElementById("imagenes").value.split(",").map(s=>s.trim()),
    categoria:{ main: document.getElementById("mainCat").value, sub: document.getElementById("subCat").value },
    price: Number(document.getElementById("price").value),
    stock: Number(document.getElementById("stock").value)
  };
  productos.push(nuevo);
  guardarProductos();
  mostrarMensaje();
  formProducto.reset();
  renderProductos(searchInput.value);
});

// --- SEARCH --- 
searchInput.addEventListener("input", () => renderProductos(searchInput.value));

</script>
</body>
</html>
