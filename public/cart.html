<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LaTRONIC Cart</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#121212; color:#fff; display:flex; min-height:100vh; }
  aside { 
    width:250px; 
    background:#1e1e1e; 
    padding:1rem; 
    position:sticky; 
    top:0; 
    height:100vh; 
    display:flex; 
    flex-direction:column; 
    justify-content:space-between; 
    overflow-y:auto; 
  }
  aside h2 { font-size:1.2rem; margin-bottom:1rem; }
  .menu { list-style:none; padding:0; margin:0; }
  .menu>li { margin-bottom:0.5rem; position:relative; }
  .boton-categoria { 
    display:block; 
    background:none; 
    border:none; 
    color:#fff; 
    text-align:left; 
    width:100%; 
    padding:0.5rem; 
    font-size:1rem; 
    cursor:pointer; 
    transition: background 0.3s; 
    text-decoration:none; 
    border-radius:5px; 
  }
  .boton-categoria:hover, .boton-categoria.active { 
    background:#e28e2fa9; 
    color:black; 
  }
  main { flex:1; padding:2rem; }
  footer { text-align:center; padding:1rem 0; color:rgba(128,128,128,0.6); font-size:0.9rem; }
  .logo { font-family:"Bebas Neue",sans-serif; font-size:3rem; letter-spacing:2px; text-align:center; text-transform:uppercase; display:inline-block; position:relative; color:#f16413b9; padding:1rem 2rem; border-radius:12px; }
  .cart-producto { display:flex; justify-content:space-between; align-items:center; background:#1e1e1e; padding:1rem; border-radius:10px; margin-bottom:1rem; box-shadow:0 4px 8px rgba(0,0,0,0.5); }
  .cart-producto img { width:80px; height:80px; border-radius:8px; object-fit:cover; margin-right:1rem; }
  .cart-producto-info { flex:1; }
  .cart-producto-info h3 { margin:0 0 0.3rem 0; font-size:1rem; }
  .cart-producto-info p { margin:0.2rem 0; display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; }
  .boton-carrito { font-family:"Oswald", sans-serif; border:none; padding:0.8rem 1.2rem; border-radius:8px; cursor:pointer; font-size:0.9rem; transition:0.3s; background:#e28f2f; color:black; font-weight:bold; }
  .boton-carrito:hover { background:#f16413; color:white; }
  .boton-cantidad { background:#e28f2f; color:white; border:none; border-radius:5px; padding:0.2rem 0.6rem; cursor:pointer; font-weight:bold; transition:0.3s; }
  .boton-cantidad:hover { background:#f16413b9; color:black; }
  .boton-cantidad:disabled { background:#555; color:#ccc; cursor:not-allowed; }
  .cart-acciones { margin-top:2rem; display:flex; justify-content:space-between; align-items:center; background:#1e1e1e; padding:1rem; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.5); flex-wrap:wrap; gap:1rem; }
  #cart-vacio { font-size:1.2rem; text-align:center; margin-top:2rem; color:#ccc; }
  .cart-button-container button { font-family:"Bebas Neue", sans-serif; background:none; border:none; color:#fff; text-align:left; width:100%; padding:0.6rem 1rem; font-size:1.1rem; cursor:pointer; transition:0.3s; border-radius:5px; }
  .cart-button-container button:hover { background:#e28e2fa9; color:black; }
  .back-menu { margin-bottom:1rem; font-family:"Oswald", sans-serif; background:#e28f2f; color:black; border:none; padding:0.6rem 1rem; border-radius:8px; cursor:pointer; font-weight:bold; transition:0.3s; }
  .back-menu:hover { background:#f16413; color:white; }
  .input-group { margin-top:1rem; }
  .input-group label { font-size:0.9rem; font-weight:600; margin-bottom:4px; display:block; }
  .input-group select { width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; font-size:0.9rem; background:#1e1e1e; color:#fff; }
</style>
</head>
<body>
<aside>
  <h1 class="logo">LaTRONIC</h1>
  <ul class="menu">
    <li><a class="boton-categoria" href="index.html">Home</a></li>
    <li class="cart-button-container">
      <button id="ir-carrito">üõí Cart (<span id="cart-count">0</span>)</button>
    </li>
  </ul>
  <footer>
    <div>‚úâÔ∏èlatronicstore@gmail.com</div>
    <div>Located in Connecticut, USA</div>
    <div>‚ìí 2025 LaTRONIC LLC</div>
  </footer>
</aside>

<main>
  <button class="back-menu" onclick="window.location.href='shop.html'">‚Üê Back to Menu</button>
  <h1 class="titulo-principal">Your Cart</h1>
  <div id="cart-vacio" style="display:none;">Your cart is empty <i class="bi bi-emoji-frown"></i></div>
  <div id="cart-productos"></div>

  <div class="cart-acciones" id="cart-acciones" style="display:none;">
    <button id="cart-acciones-vaciar" class="boton-carrito">Empty Cart</button>
    <button id="cart-acciones-buy" class="boton-carrito">Buy Now</button>
    <div class="input-group">
      <label for="estado">Select your state:</label>
      <select id="estado">
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
      </select>
    </div>
  </div>

  <!-- BLOQUE DE TOTALES AGREGADO -->
  <div class="cart-totales" style="margin-top:1rem; text-align:right;">
    <p>Subtotal: $<span id="subtotal">0.00</span></p>
    <p>Taxes: $<span id="taxes">0.00</span></p>
    <p id="total-display">Total: $0.00</p>
  </div>
</main>

<script>
// --- CARRITO SINCRONIZADO CON SHOP + CONTROL DE STOCK ---
let cart = JSON.parse(localStorage.getItem("productos-en-cart")) || [];
let productos = JSON.parse(localStorage.getItem("productos")) || [];

// Garantizar stockOriginal
productos.forEach(p => { if (p.stockOriginal === undefined) p.stockOriginal = p.stock; });

function actualizarCarrito() {
  const cartProductosEl = document.getElementById("cart-productos");
  const cartAccionesEl = document.getElementById("cart-acciones");
  const cartVacioEl = document.getElementById("cart-vacio");

  if (!cart || cart.length === 0) {
    cartVacioEl.style.display = "block";
    cartAccionesEl.style.display = "none";
    cartProductosEl.innerHTML = "";
    actualizarTotales(0);
    return;
  }

  cartVacioEl.style.display = "none";
  cartAccionesEl.style.display = "flex";
  cartProductosEl.innerHTML = "";

  let subtotal = 0;

  cart.forEach(p => {
    // --- Asegurarse de que el producto tenga im√°genes ---
    if (!p.imagenes || p.imagenes.length === 0) {
      const prodOriginal = productos.find(pr => pr.id === p.id);
      if (prodOriginal && prodOriginal.imagenes) {
        p.imagenes = prodOriginal.imagenes;
      }
    }

    const imagenSrc = p.imagenes?.[0] || "https://via.placeholder.com/80";
    const cantidad = p.quantity || 1;
    subtotal += parseFloat(p.price) * cantidad;

    const div = document.createElement("div");
    div.className = "cart-producto";
    div.innerHTML = `
      <img src="${imagenSrc}" alt="${p.titulo}">
      <div class="cart-producto-info">
        <h3>${p.titulo}</h3>
        <p>Price: $${parseFloat(p.price).toFixed(2)}</p>
        <p>Quantity:
          <button class="boton-cantidad" data-id="${p.id}" data-action="minus">‚àí</button>
          <span>${cantidad}</span>
          <button class="boton-cantidad" data-id="${p.id}" data-action="plus">+</button>
        </p>
        <p class="stock-text">Stock: ${productos.find(pr => pr.id === p.id)?.stock ?? "N/A"}</p>
      </div>
      <button class="boton-carrito cart-eliminar" data-id="${p.id}">Delete</button>
    `;
    cartProductosEl.appendChild(div);
  });

  // --- Eventos para eliminar producto ---
  document.querySelectorAll(".cart-eliminar").forEach(btn => {
    btn.onclick = () => {
      cart = cart.filter(p => p.id !== btn.dataset.id);
      guardarCarrito();
      actualizarCarrito();
    };
  });

  // --- Eventos para aumentar/disminuir cantidad ---
  document.querySelectorAll(".boton-cantidad").forEach(btn => {
    btn.onclick = () => {
      const id = btn.dataset.id;
      const accion = btn.dataset.action;
      const productoCarrito = cart.find(p => p.id === id);
      const productoOriginal = productos.find(p => p.id === id);
      if (!productoCarrito || !productoOriginal) return;

      if (accion === "plus") {
        if (productoCarrito.quantity >= productoOriginal.stockOriginal) {
          alert(`Not enough stock for ${productoCarrito.titulo}. Only ${productoOriginal.stockOriginal} left.`);
          return;
        }
        productoCarrito.quantity++;
      } else if (accion === "minus") {
        productoCarrito.quantity = Math.max((productoCarrito.quantity || 1) - 1, 1);
      }
      guardarCarrito();
      actualizarCarrito();
    };
  });

  actualizarTotales(subtotal);
}

function guardarCarrito() {
  localStorage.setItem("productos-en-cart", JSON.stringify(cart));
  productos.forEach(p => {
    if (p.stockOriginal === undefined) p.stockOriginal = p.stock;
    p.stock = p.stockOriginal;
  });
  localStorage.setItem("productos", JSON.stringify(productos));
  window.dispatchEvent(new Event("storage"));
}

function actualizarTotales(subtotal) {
  const estadoCliente = document.getElementById("estado")?.value || "";
  const taxRateCT = 0.0635;
  const taxes = estadoCliente === "CT" ? subtotal * taxRateCT : 0;
  const total = subtotal + taxes;

  document.getElementById("subtotal").textContent = subtotal.toFixed(2);
  document.getElementById("taxes").textContent = taxes.toFixed(2);
  document.getElementById("total-display").textContent = `Total: $${total.toFixed(2)}`;
  document.getElementById("cart-count").textContent = cart.reduce((a, p) => a + (p.quantity || 1), 0);
}

// --- EVENTO PARA ACTUALIZAR TAXES AL CAMBIAR ESTADO ---
const estadoSelect = document.getElementById("estado");
estadoSelect.addEventListener("change", () => {
  localStorage.setItem("estado-cliente", estadoSelect.value);
  const subtotal = cart.reduce((acc, p) => acc + (parseFloat(p.price) * (p.quantity || 1)), 0);
  actualizarTotales(subtotal);
});

// --- Vaciar carrito ---
document.getElementById("cart-acciones-vaciar").onclick = () => {
  cart = [];
  guardarCarrito();
  actualizarCarrito();
};

// --- Comprar ahora ---
document.getElementById("cart-acciones-buy").onclick = () => {
  if (cart.length === 0) {
    alert("Your cart is empty! ‚ùå");
    return;
  }
  cart.forEach(p => {
    const prod = productos.find(pr => pr.id === p.id);
    if (prod) prod.stock = Math.max(prod.stock - (p.quantity || 1), 0);
  });

  localStorage.setItem("productos", JSON.stringify(productos));
  localStorage.setItem("productos-en-cart", JSON.stringify(cart));
  window.location.href = "card-charge.html";
};

// --- Restaurar estado del cliente ---
const estadoGuardado = localStorage.getItem("estado-cliente");
if (estadoSelect && estadoGuardado) estadoSelect.value = estadoGuardado;

// --- Inicializar carrito ---
actualizarCarrito();
</script>


</body>
</html>
