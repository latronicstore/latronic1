<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LaTRONIC Store</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
<style>
/* --- BODY --- */
body { margin: 0; font-family: Arial, sans-serif; background: #121212; color: #ffffffcb; display: flex; min-height: 100vh; }
/* --- ASIDE --- */
aside { position: fixed; top: 0; left: 0; height: 100vh; width: 220px; overflow-y: auto; background: rgba(26, 26, 26, 0.6); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); padding: 1rem 0.8rem; z-index: 1500; border-right: 1px solid rgba(226, 143, 47, 0.4); transition: background 0.3s ease, backdrop-filter 0.3s ease; }
aside h2 { font-size: 2rem; text-align: center; margin-bottom: 1.5rem; color: #e28f2f; letter-spacing: 1px; }
.menu { list-style: none; padding: 0; margin: 0; background: #1a1a1a; }
.menu>li { margin-bottom: 2rem; margin-left: 1.2rem; position: relative; }
.boton-categoria { display: block; width: 100%; background: transparent; color: #e28f2f; border: none; text-align: left; font-size: 1.1rem; padding: 0.5rem 0.7rem; border-radius: 8px; cursor: pointer; transition: background 0.2s ease, transform 0.1s ease; }
.boton-categoria:hover { background: rgba(226, 143, 47, 0.25); mtransform: translateX(4px); color: #f0f0f0; }
.submenu { display: none; list-style: none; margin: 0; padding-left: 1rem; border-left: 2px solid rgba(226, 143, 47, 0.3); }
.submenu li { list-style: none; }
.submenu .boton-categoria { font-size: 1rem; padding: 0.4rem 0.7rem; }
.submenu .boton-categoria:hover { background: #f16413b9; color: #050505; border-radius: 5px; }

/* --- SEARCH BAR --- */
.search-bar { display:flex; justify-content:center; align-items:center; gap:8px; margin-bottom:12px; }
#search-input { padding:10px 14px; width:60%; border-radius:24px; border:1px solid #333; background:#141414; color:#fff; outline:none; font-size:0.95rem; box-shadow:none; transition: box-shadow .15s, border-color .15s; }
#search-input:focus { border-color: #e28f2f; box-shadow: 0 0 8px rgba(226,143,47,0.15); }
#search-btn { padding:9px 12px; border-radius:50%; border:none; background:#e28f2f; cursor:pointer; font-weight:bold; }
#search-btn:hover { background:#f16413b9; color:#fff; }

/* --- CARRITO --- */
.cart-button-container { position: relative; z-index: 2000; }
.carrito { background: #e28f2f; border-radius: 5px; border-color: #1a1a1a; position: relative; z-index: 2001; cursor: pointer; }
.carrito:hover { background: #f16413b9; }

/* --- MAIN --- */
main { margin-left: 230px; padding: 2rem; transition: margin-left 0.3s ease; }
footer { text-align: center; padding: 1rem 0; color: #ffffff9f; font-size: 0.7rem; }

/* --- PRODUCTOS --- */
#contenedor-productos { 
  display: flex; 
  flex-wrap: wrap; 
  gap: 15px; 
  justify-content: flex-start; 
}

.title { font-family: "Bebas Neue", sans-serif; font-size: 2.5rem; text-align: center; color: #f16413b9; margin: 0; }
#titulo-principal { transition: all 0.3s ease; text-align: center; margin: 0; font-family: "Bebas Neue", sans-serif; font-size: 2.5rem; color: #f16413b9; }
aside.active ~ main #titulo-principal { text-align: center; margin-top: 50px; }
.producto { flex: 0 0 120px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; text-align: center; border: 1px solid #ccc; padding: 6px; margin: 0; background: #1a1a1a; border-radius: 5px; transition: transform 0.3s; overflow: hidden; }
.producto:hover { transform: scale(1.03); }
.agregar-carrito[disabled] { background: #888; color: #ccc; cursor: not-allowed; opacity: 0.7; position: relative; z-index: 1; }
.agregar-carrito { background-color: #e28f2f; color: black; border: none; padding: 0.3rem 0.6rem; cursor: pointer; border-radius: 5px; transition: background 0.3s, color 0.3s; font-weight: bold; font-size: 0.8rem; margin-top: 8px; }
.agregar-carrito:hover { background-color: #f16413b9; color: #fff; }
.toggle-submenu.active { background: #e28e2fa9; color: black; }
.galeria { width: 100%; max-width: 120px; aspect-ratio: 1/1; margin: 0 auto 6px; position: relative; overflow: hidden; border-radius: 6px; }
.main-img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; cursor: zoom-in; display: block; }
.arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: #fff; border: none; width: 24px; height: 24px; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; z-index: 10; transition: background 0.2s; }
.arrow:hover { background: rgba(0,0,0,0.7); }
.arrow.prev { left: 2px; } .arrow.next { right: 2px; }

/* --- MODAL NEGOCIAR --- */
.negociar { background: linear-gradient(135deg, #f16413, #e28f2f); color: #050505; border: none; padding: 6px 12px; cursor: pointer; border-radius: 25px; font-weight: bold; font-size: 0.8rem; margin-top: 6px; transition: transform 0.2s, box-shadow 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
.negociar:hover { transform: translateY(-2px); color: white; box-shadow: 0 6px 10px rgba(0,0,0,0.4); background: linear-gradient(135deg, #e28f2f, #f16413); }

/* --- BOT√ìN ADMIN --- */
#admin-access { position: fixed; bottom: 18px; right: 18px; width: 40px; height: 40px; background: linear-gradient(135deg, #e28f2f, #f16413); color: #000; border: none; border-radius: 50%; font-size: 20px; font-weight: bold; cursor: pointer; z-index: 9999; box-shadow: 0 4px 10px rgba(0,0,0,0.4); transition: transform 0.25s, box-shadow 0.3s, background 0.3s; }
#admin-access:hover { transform: scale(1.1); background: linear-gradient(135deg, #f16413, #e28f2f); color: white; box-shadow: 0 6px 15px rgba(0,0,0,0.6); }

.hamburger { display: none; position: fixed; top: 15px; left: 15px; font-size: 30px; color: #e28f2f; cursor: pointer; z-index: 3000; }

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  main { margin-left: 0; padding: 1rem; position: relative; z-index: 1; }
  aside { position: fixed; top: 0; left: -250px; width: 220px; height: 100%; z-index: 2000; transition: left 0.3s ease; }
  aside.active { left: 0; box-shadow: 2px 0 8px rgba(0,0,0,0.5); margin-top: 45px; }
  .hamburger { display: block; top: 45px; left: 15px; font-size: 30px; z-index: 3000; }
  .galeria { width: 100px; aspect-ratio: 1/1; }
  .producto { flex: 0 0 100px; padding: 5px; }
  .arrow { width: 20px; height: 20px; font-size: 14px; }
  #contenedor-productos { justify-content: center; }
}

/* --- SEARCH --- */
#search-bar:focus { border-color: #e28f2f; box-shadow: 0 0 6px #e28f2f; background: #222; }
#search-bar::placeholder { color: rgba(255,255,255,0.5); }

.link { color: #e28f2f; text-decoration: none; }
.link:hover { text-decoration: underline; color: red;}

/* --- AGE CHECK MODAL STYLES --- */
/* --- AGE CHECK MODAL --- */
.age-check-modal {
  display: flex; /* Siempre flex para centrar, oculto con opacity */
  position: fixed;
  top:0;
  left:0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.95);
  justify-content: center;
  align-items: center;
  z-index: 10000;
  opacity: 0;
  pointer-events: none; /* Evita interacci√≥n cuando invisible */
  transition: opacity 0.4s ease;
}

.age-check-modal.show {
  opacity: 1;
  pointer-events: auto; /* Permite interacci√≥n cuando visible */
}

/* Animaci√≥n del cuadro */
.age-check-box {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 30px 40px;
  max-width: 450px;
  text-align: center;
  box-shadow: 0 0 25px rgba(0,0,0,0.7);
  transform: translateY(-200px);
  transition: transform 0.4s ease, opacity 0.4s ease;
  opacity: 0;
}

/* Cuando se muestra */
.age-check-modal.show .age-check-box {
  transform: translateY(0);
  opacity: 1;
}

/* Cuando se cierra */
.age-check-modal.hide .age-check-box {
  transform: translateY(-200px);
  opacity: 0;
}

/* T√≠tulos y texto */
.age-check-box h2 {
  color: #e28f2f;
  margin-bottom: 15px;
  font-size: 1.5rem;
}

.age-check-box p {
  color: #fff;
  font-size: 1rem;
  line-height: 1.4;
  margin-bottom: 25px;
}

/* Botones */
.age-check-buttons button {
  padding: 10px 22px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  margin: 0 5px;
  transition: all 0.2s;
}

#ageYes {
  background: #e28f2f;
  color: #1a1a1a;
}

#ageYes:hover {
  background: #21e607;
}

#ageNo {
  background: #333;
  color: #fff;
}

#ageNo:hover {
  background: #e20c0c;
}

#vinylEmail:hover{
  background: red;
}

#vinylOk:hover{
  background: red;
}

</style>
</head>
<body>
  
<div class="hamburger">&#9776;</div>

<aside>
  <h2 class="title">LaTRONIC</h2>
  <ul class="menu">
    <li><a class="boton-categoria" href="index.html">Home</a></li>

    <!-- NEW -->
    <li>
      <button class="boton-categoria toggle-submenu" data-main="new">New Card</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="new" data-sub="basketball">Basketball</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="baseball">Baseball</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="football">Football</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="hockey">Hockey</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="ufc">UFC</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="soccer">Soccer</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="olympics">Olympics</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="boxing">Boxing</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="wrestling">Wrestling</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="race-car">Racecar</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="pokemon">Pokemon</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="disney">Disney</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="avenger&marvel">Avenger & Marvel</button></li>
        <li><button class="boton-categoria" data-main="new" data-sub="animes">Animes</button></li>
      </ul>
    </li>

    <!-- USED -->
    <li>
      <button class="boton-categoria toggle-submenu" data-main="used">Used Card</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="used" data-sub="basketball">Basketball</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="baseball">Baseball</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="football">Football</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="hockey">Hockey</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="ufc">UFC</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="soccer">Soccer</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="olympics">Olympics</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="boxing">Boxing</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="wrestling">Wrestling</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="race-car">Racecar</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="pokemon">Pokemon</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="disney">Disney</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="avenger&marvel">Avenger & Marvel</button></li>
        <li><button class="boton-categoria" data-main="used" data-sub="animes">Animes</button></li>
      </ul>
    </li>

    <!--Clothes-->
    <li>
      <button class="boton-categoria toggle-submenu" data-main="clothes">Clothes</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="clothes" data-sub="men">Men</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="women">Women</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="teenager">Boys</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="teenager">Girls</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="baby">Baby&Toddler</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="unisexAdult">Adult Unisex</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="unisexTeenager">Teenager Unisex</button></li>
        <li><button class="boton-categoria" data-main="clothes" data-sub="unisexKids">Baby&Toddler Unisex</button></li>
        
        
      </ul>
    </li>


    <!--Vinyl Decals--> 
    <li>
      <button class="boton-categoria toggle-submenu" data-main="decals">Vinyl Decals</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="decals" data-sub="car">Cars & SUV</button></li>
        <li><button class="boton-categoria" data-main="decals" data-sub="motorcycle">Motorcycle & Bike</button></li>
      </ul>
    </li>

    <!--Jewelry--> 
    <li>
      <button class="boton-categoria toggle-submenu" data-main="jewelry">Jewelry</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="jewelry" data-sub="gold">Gold</button></li>
        <li><button class="boton-categoria" data-main="jewelry" data-sub="silver">Silver 925</button></li>
        <li><button class="boton-categoria" data-main="jewelry" data-sub="watch">Watches</button></li>

      </ul>
    </li>

    <!-- MORE -->
    <li>
      <button class="boton-categoria toggle-submenu" data-main="more">More</button>
      <ul class="submenu">
        <li><button class="boton-categoria" data-main="more" data-sub="history">History</button></li>
        <li><button class="boton-categoria" data-main="more" data-sub="magazines">Magazines</button></li>
         <li><button class="boton-categoria" data-main="more" data-sub="adultmagazines">Adult-Magazines</button></li>
        <li><button class="boton-categoria" data-main="more" data-sub="comics">Comics</button></li>
        <li><button class="boton-categoria" data-main="more" data-sub="figures">Figures</button></li>
        <li><button class="boton-categoria" data-main="more" data-sub="toys">Toys</button></li>
      </ul>
    </li>

    <!-- CART + FOOTER -->
    <li class="cart-button-container">
      <button id="cart-btn" class="carrito">üõí Cart (<span id="cart-count">0</span>)</button>

      <footer>
        <a href="aboutus.html" class="link">About Us</a> | <a href="contactus.html" class="link">Contact Us</a><br>
        Email-latronicstore@gmail.com<br>
        Located in Connecticut, USA<br>
        &copy; 2025 LaTRONIC LLC. All rights reserved.
      </footer>
    </li>
  </ul>
</aside>

<main>
  <h1 id="titulo-principal">All Products</h1>

  <!-- SEARCH -->
  <div class="search-bar" style="margin-top:12px;">
    <input id="search-input" type="text" placeholder="Search..."
    <button id="search-btn" title="Buscar">üîé</button>
  </div>

  <div id="contenedor-productos"></div>
  <button id="admin-access" title="Admin Panel">‚öôÔ∏è</button>
</main>

<!-- MODAL NEGOCIAR -->
<div id="negociar-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;z-index:6000;">
  <div style="background:#2a2a2a;padding:20px;border-radius:10px;display:flex;flex-direction:column;align-items:center;position:relative;">
    <span id="cerrar-negociar" style="position:absolute;top:10px;right:15px;font-size:28px;cursor:pointer;color:#fff;">&times;</span>
    <h2 id="negociar-producto" style="color:#e28f2f;margin-bottom:10px;"></h2>
    <input type="email" id="negociar-email" placeholder="Your Email" style="margin-bottom:10px;padding:8px;border-radius:6px;border:1px solid #333;background:#141414;color:#fff;">
    <input type="number" id="negociar-precio" placeholder="Offer Price" style="margin-bottom:10px;padding:8px;border-radius:6px;border:1px solid #333;background:#141414;color:#fff;">
    <button id="enviar-negociacion" style="padding:8px 12px;border:none;border-radius:6px;background:#e28f2f;color:black;font-weight:bold;cursor:pointer;">Make an Offer</button>
    <p id="negociar-status" style="color:#fff;margin-top:10px;"></p>
  </div>
</div>

<!-- MODAL ZOOM -->
<div id="zoom-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;z-index:7000;cursor:pointer;flex-direction:column;">
  <button id="zoom-prev" class="arrow prev">&#9664;</button>
  <img id="zoom-img" src="" style="max-width:80%;max-height:70%;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.7);">
  <button id="zoom-next" class="arrow next">&#9654;</button>
  <div id="zoom-info" style="margin-top:10px; color:#fff; max-width:90%; text-align:center;">
    <h3 id="zoom-title" style="margin:5px 0;"></h3>
    <p id="zoom-desc" style="margin:0;"></p>
  </div>
</div>

<!-- MODAL VERIFICACI√ìN ADULTO -->
<!-- AGE CHECK MODAL -->
<div id="ageCheckModal" class="age-check-modal">
  <div class="age-check-box">
    <h2>Adult Content Warning</h2>
    <p>This section contains adult material that may not be suitable for minors. By clicking ‚ÄúYes, I am 18+‚Äù, you confirm that you are at least 18 years old (or the legal age in your jurisdiction) and agree to view this content. If you are under 18, or do not wish to view adult content, please click ‚ÄúNo, exit‚Äù and leave this section immediately.</p>
    <div class="age-check-buttons">
      <button id="ageYes">Yes, I am 18+</button>
      <button id="ageNo">No, exit</button>
    </div>
  </div>
</div>

<!-- VINYL DECALS CUSTOM DESIGN MODAL -->
<div id="vinylModal" class="age-check-modal">
  <div class="age-check-box">
    <h2>Custom Vinyl Design</h2>
    <p>
      Have your own custom design?<br><br>
      You may email it to us and we will review it to provide a price estimate
      or confirm whether we can produce the design.
    </p>

    <p style="margin-top:10px;font-weight:bold;">
      üìß latronicstore@gmail.com
    </p>

    <div class="age-check-buttons">
  <button id="vinylEmail">Email Us</button>
  <button id="vinylOk">Got it</button>
</div>

  </div>
</div>






<!-- Socket.io -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.1/dist/email.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const BASE_URL = window.location.origin;
  const contenedor = document.getElementById("contenedor-productos");
  const cartCountEl = document.getElementById("cart-count");
  const toggleButtons = document.querySelectorAll(".toggle-submenu");
  const hamburger = document.querySelector(".hamburger");
  const aside = document.querySelector("aside");
  const socket = io(BASE_URL);

  // --- Bot√≥n carrito
  const cartBtn = document.getElementById("cart-btn");
  if (cartBtn) {
    cartBtn.addEventListener("click", e => {
      e.preventDefault();
      window.location.href = "cart.html";
    });
  }

  // --- Bot√≥n Admin
  const adminBtn = document.getElementById("admin-access");
  if (adminBtn) {
    adminBtn.addEventListener("click", () => {
      window.location.href = "admin.html";
    });
  }

  // --- Men√∫ lateral
  if (hamburger && aside) {
    hamburger.addEventListener("click", () => aside.classList.toggle("active"));
  }
  toggleButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const submenu = btn.nextElementSibling;
      const isVisible = submenu.style.display === "block";
      document.querySelectorAll(".submenu").forEach(sm => sm.style.display = "none");
      document.querySelectorAll(".toggle-submenu").forEach(b => b.classList.remove("active"));
      if (!isVisible) {
        submenu.style.display = "block";
        btn.classList.add("active");
      }
    });
  });




// --- AGE CHECK MODAL
const adultButton = document.querySelector('button[data-sub="adultmagazines"]');
const ageModal = document.getElementById("ageCheckModal");
const ageYes = document.getElementById("ageYes");
const ageNo = document.getElementById("ageNo");

if (adultButton && ageModal && ageYes && ageNo) {
  adultButton.addEventListener("click", (e) => {
    e.preventDefault();
    ageModal.classList.add("show");
  });

  ageYes.addEventListener("click", () => {
    ageModal.classList.remove("show");
    console.log("Access granted to Adult-Magazines");
    // loadCategory("more","adultmagazines"); // Descomenta si tienes funci√≥n para cargar
  });

  ageNo.addEventListener("click", () => {
  ageModal.classList.remove("show");
  alert("Sorry, you must be 18 years or older to access this section.");
  window.location.href = "index.html"; // Redirige a la p√°gina principal
});

}





  if (aside) {
    aside.addEventListener("click", e => {
      const btn = e.target.closest(".submenu .boton-categoria");
      if (!btn) return;
      const main = (btn.dataset.main || "").toLowerCase();
      const sub = (btn.dataset.sub || "").toLowerCase();
      const titulo = document.getElementById("titulo-principal");
      if (titulo) titulo.textContent = `${capitalize(main)} ¬∑ ${capitalize(sub)}`;
      const filtrados = productosMaster.filter(p =>
        (p.categoria?.main || "").toLowerCase() === main &&
        (p.categoria?.sub || "").toLowerCase() === sub
      );
      renderProductos(filtrados);
      aside.classList.remove("active");
    });
  }

  function capitalize(str) { return (str || "").charAt(0).toUpperCase() + (str || "").slice(1); }

  // --- Obtener productos
  async function obtenerProductos() {
    try {
      const res = await fetch(BASE_URL + "/api/productos", { cache: "no-store" });
      if (!res.ok) throw new Error("Error cargando productos");
      const data = await res.json();
      const productosFinal = data.map(p => {
    const stock = typeof p.stock === "number" ? p.stock : Number(p.stock || 0);
    return {
      ...p,
      stock,
      stockOriginal: stock,
      price: p.price ?? 0,   // <-- usar siempre el backend
      soldOut: stock <= 0,
      imagenes: (p.imagenes || []).map(url => url ? (url.startsWith("/") ? BASE_URL + url : url) : "").filter(Boolean)
    };

   

});

// --- VINYL DECALS MODAL (MISMO ESTILO QUE ADULT)
const vinylModal = document.getElementById("vinylModal");
const vinylOk = document.getElementById("vinylOk");
const vinylClose = document.getElementById("vinylClose");

// detectar SOLO el bot√≥n "Vinyl Decals"
const vinylBtn = [...document.querySelectorAll(".toggle-submenu")]
  .find(btn => btn.textContent.trim() === "Vinyl Decals");

if (vinylBtn && vinylModal) {
  vinylBtn.addEventListener("click", (e) => {
    e.preventDefault();
    vinylModal.classList.add("show");
  });
}

if (vinylOk) {
  vinylOk.addEventListener("click", () => {
    vinylModal.classList.remove("show");
  });
}

const vinylEmail = document.getElementById("vinylEmail");

if (vinylEmail) {
  vinylEmail.addEventListener("click", () => {
    window.location.href =
      "mailto:latronicstore@gmail.com?subject=Custom Vinyl Design Request";
  });
}


if (vinylClose) {
  vinylClose.addEventListener("click", () => {
    vinylModal.classList.remove("show");
  });
}



      localStorage.setItem("productos", JSON.stringify(productosFinal));
      return productosFinal;
    } catch (err) {
      console.error("Error fetch productos:", err);
      return JSON.parse(localStorage.getItem("productos")) || [];
    }
  }

  // Productos en memoria
  let productos = await obtenerProductos();
  // productosMaster ser√° la lista maestra (para b√∫squeda)
  let productosMaster = Array.isArray(productos) ? productos.slice() : [];

  // --- Modal de zoom
  const zoomModal = document.createElement("div");
  zoomModal.id = "zoom-modal";
  zoomModal.style.cssText = `display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:7000; cursor:pointer; flex-direction:column;`;

  const zoomImg = document.createElement("img");
  zoomImg.id = "zoom-img";
  zoomImg.style.cssText = `max-width:80%; max-height:70%; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.7);`;

  const zoomDesc = document.createElement("p");
  zoomDesc.id = "zoom-desc";
  zoomDesc.style.cssText = `color:white; text-align:center; margin-top:10px; max-width:90%; font-size:1rem;`;

  const zoomControls = document.createElement("div");
  zoomControls.style.cssText = "display:flex; width:100%; justify-content:space-between; position:absolute; top:50%; left:0; padding:0 20px; box-sizing:border-box;";

  const zoomPrev = document.createElement("button");
  zoomPrev.innerHTML = "&#9664;";
  zoomPrev.style.cssText = "font-size:3rem; color:white; background:none; border:none; cursor:pointer;";

  const zoomNext = document.createElement("button");
  zoomNext.innerHTML = "&#9654;";
  zoomNext.style.cssText = "font-size:3rem; color:white; background:none; border:none; cursor:pointer;";

  zoomControls.append(zoomPrev, zoomNext);
  zoomModal.append(zoomImg, zoomDesc, zoomControls);
  document.body.appendChild(zoomModal);

  let currentProductImages = [];
  let currentZoomIndex = 0;
  let currentProducto = null;

  function openZoomModal(producto, index) {
    if (!producto.imagenes?.length) return;
    currentProducto = producto;
    currentProductImages = producto.imagenes;
    currentZoomIndex = index || 0;
    zoomImg.src = currentProductImages[currentZoomIndex];
    zoomDesc.textContent = producto.description || "";
    zoomModal.style.display = "flex";

    if (window.innerWidth <= 600) {
      zoomImg.style.maxWidth = "90%";
      zoomImg.style.maxHeight = "50%";
    } else {
      zoomImg.style.maxWidth = "80%";
      zoomImg.style.maxHeight = "70%";
    }

    zoomPrev.style.display = currentProductImages.length > 1 ? "block" : "none";
    zoomNext.style.display = currentProductImages.length > 1 ? "block" : "none";
  }

  zoomPrev.addEventListener("click", e => {
    e.stopPropagation();
    currentZoomIndex = (currentZoomIndex - 1 + currentProductImages.length) % currentProductImages.length;
    zoomImg.src = currentProductImages[currentZoomIndex];
    zoomDesc.textContent = currentProducto.description || "";
  });

  zoomNext.addEventListener("click", e => {
    e.stopPropagation();
    currentZoomIndex = (currentZoomIndex + 1) % currentProductImages.length;
    zoomImg.src = currentProductImages[currentZoomIndex];
    zoomDesc.textContent = currentProducto.description || "";
  });

  zoomModal.addEventListener("click", () => {
    zoomModal.style.display = "none";
    zoomImg.src = "";
    zoomDesc.textContent = "";
  });

  // --- Render productos
  function renderProductos(lista, scrollY = null) {
    const carrito = JSON.parse(localStorage.getItem("productos-en-cart")) || [];
    contenedor.innerHTML = "";
    if (!Array.isArray(lista) || lista.length === 0) { contenedor.innerHTML = "<p>Coming soon...</p>"; return; }

    lista.forEach(prod => {
      const div = document.createElement("div");
      div.className = "producto";
      div.dataset.id = prod.id;

      const galeria = document.createElement("div"); galeria.className = "galeria";

      const mainImg = document.createElement("img"); mainImg.className = "main-img";
      mainImg.src = prod.imagenes?.[0] || "https://via.placeholder.com/150";
      mainImg.dataset.index = 0;
      mainImg.style.cursor = "zoom-in";
      mainImg.style.width = "100%";
      mainImg.style.borderRadius = "10px";

      mainImg.addEventListener("click", () => openZoomModal(prod, parseInt(mainImg.dataset.index)));

      galeria.append(mainImg);
      const h3 = document.createElement("h3"); h3.textContent = prod.titulo;

      const carritoItem = carrito.find(c => c.id === prod.id);
      const cantidadEnCarrito = carritoItem?.quantity || 0;
      const stockRestante = (typeof prod.stock === "number" ? prod.stock : 0) - cantidadEnCarrito;

      const pStock = document.createElement("p"); pStock.className = "stock";
      pStock.textContent = stockRestante > 0 ? `Stock: ${stockRestante}` : "Out of stock";
      pStock.style.color = stockRestante > 0 ? "gray" : "red";

      const pPrice = document.createElement("p");
      pPrice.className = "price";
      pPrice.style.color = "#e28f2f"; pPrice.style.fontWeight = "bold";
      pPrice.textContent = "$" + (prod.price ?? "0");

      const btn = document.createElement("button");
      btn.className = "agregar-carrito";
      btn.dataset.id = prod.id;
      btn.disabled = stockRestante <= 0;
      btn.textContent = stockRestante > 0 ? (carritoItem ? `Add (${carritoItem.quantity})` : "Add") : "Out of stock";
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        let carritoLocal = JSON.parse(localStorage.getItem("productos-en-cart")) || [];
        const index = carritoLocal.findIndex(c => c.id === prod.id);
        if (cantidadEnCarrito < prod.stock) {
          if (index !== -1) carritoLocal[index].quantity += 1;
          else carritoLocal.push({ id: prod.id, titulo: prod.titulo, price: prod.price, quantity: 1 });
          localStorage.setItem("productos-en-cart", JSON.stringify(carritoLocal));
        }
        cartCountEl.textContent = carritoLocal.reduce((acc, i) => acc + i.quantity, 0);
        renderProductos(lista, window.scrollY);
      });

      // --- Bot√≥n Send Offer
      const btnNegociar = document.createElement("button");
      btnNegociar.className = "negociar";
      btnNegociar.textContent = "Make Offer";
      btnNegociar.addEventListener("click", () => {
        document.getElementById("negociar-modal").style.display = "flex";
        document.getElementById("negociar-producto").textContent = prod.titulo;
      });

      div.append(galeria, h3, pStock, pPrice, btn, btnNegociar);
      contenedor.appendChild(div);
    });

    if (scrollY !== null) window.scrollTo(0, scrollY);
    const carritoActual = JSON.parse(localStorage.getItem("productos-en-cart")) || [];
    if (cartCountEl) cartCountEl.textContent = carritoActual.reduce((acc, i) => acc + i.quantity, 0);
  }

  // --- Inicial render con la lista maestra
  // Mostrar todos menos Adult Magazines por defecto
renderProductos(productosMaster.filter(p => (p.categoria?.sub || "").toLowerCase() !== "adultmagazines"));


  // --- Buscador inteligente
  const searchInput = document.getElementById("search-input");
  const searchBtn = document.getElementById("search-btn");

  function normalizeText(t) {
    return (t || "").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }

  function doSearch() {
    if (!searchInput) return;
    const query = normalizeText(searchInput.value || "").trim();
    if (!query) {
      document.getElementById("titulo-principal").textContent = "All Products";
      renderProductos(productosMaster);
      return;
    }
    const terms = query.split(/\s+/).filter(Boolean);

    const filtrados = productosMaster.filter(p => {
  // Excluir Adult Magazines de la b√∫squeda
  if ((p.categoria?.sub || "").toLowerCase() === "adultmagazines") return false;

  const fields = [
    normalizeText(p.titulo),
    normalizeText(p.description),
    normalizeText(p.categoria?.main),
    normalizeText(p.categoria?.sub),
    ...(p.tags ? p.tags.map(t => normalizeText(t)) : [])
  ];
  return terms.every(term => fields.some(f => f.includes(term)));
});

    document.getElementById("titulo-principal").textContent = `Search: "${searchInput.value}" (${filtrados.length})`;
    renderProductos(filtrados);
  }

  if (searchBtn) {
    searchBtn.addEventListener("click", doSearch);
  } else {
    console.warn("search-btn not found in DOM. Search button won't work.");
  }

  if (searchInput) {
    // Buscar al presionar Enter y tambien en cada input (mejora UX)
    searchInput.addEventListener("keyup", e => { if (e.key === "Enter") doSearch(); });
    searchInput.addEventListener("input", () => {
      // opcional: b√∫squeda live (quita si no la quieres)
      // doSearch();
    });
  } else {
    console.warn("search-input not found in DOM. Search input won't work.");
  }

  // --- Modal de negociaci√≥n
  const cerrarNeg = document.getElementById("cerrar-negociar");
  if (cerrarNeg) {
    cerrarNeg.addEventListener("click", () => {
      document.getElementById("negociar-modal").style.display = "none";
      document.getElementById("negociar-status").textContent = "";
    });
  }

  const enviarNeg = document.getElementById("enviar-negociacion");
  if (enviarNeg) {
    enviarNeg.addEventListener("click", async () => {
      const email = document.getElementById("negociar-email").value.trim();
      const oferta = document.getElementById("negociar-precio").value.trim();
      const producto = document.getElementById("negociar-producto").textContent;
      const statusEl = document.getElementById("negociar-status");
      if (!email || !oferta) { alert("Por favor completa todos los campos"); return; }
      try {
        statusEl.textContent = "Sending offer...";
        const resp = await fetch(BASE_URL + "/api/send-offer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ producto, email, oferta })
        });
        const data = await resp.json();
        if (resp.ok) {
          statusEl.textContent = "Offer sent!";
          setTimeout(() => {
            document.getElementById("negociar-modal").style.display = "none";
            statusEl.textContent = "";
            document.getElementById("negociar-email").value = "";
            document.getElementById("negociar-precio").value = "";
          }, 900);
        } else throw new Error(data.error || "Unknown error");
      } catch (err) {
        console.error("Error sending offer:", err);
        statusEl.textContent = "Error sending offer";
      }
    });
  }

 // --- SOCKET.IO: actualizar productos en tiempo real (SIN DESCUENTO)
socket.on("actualizar-productos", (updatedProducts) => {

  const updates = Array.isArray(updatedProducts)
    ? updatedProducts
    : [updatedProducts];

  const carrito = JSON.parse(localStorage.getItem("productos-en-cart")) || [];

  updates.forEach(up => {
    const idx = productosMaster.findIndex(p => p.id === up.id);

    if (idx !== -1) {
      // actualizar existente
      up.imagenes = (up.imagenes || []).map(url =>
        url ? (url.startsWith("/") ? BASE_URL + url : url) : ""
      ).filter(Boolean);

      productosMaster[idx] = { ...productosMaster[idx], ...up };
    } else {
      // nuevo producto
      up.imagenes = (up.imagenes || []).map(url =>
        url ? (url.startsWith("/") ? BASE_URL + url : url) : ""
      ).filter(Boolean);

      productosMaster.push(up);
    }

    // actualizar DOM
    const existingDiv = contenedor.querySelector(`.producto[data-id='${up.id}']`);
    if (existingDiv) {
      const prod = productosMaster.find(p => p.id === up.id);
      const carritoItem = carrito.find(c => c.id === prod.id);
      const cantidadEnCarrito = carritoItem?.quantity || 0;
      const stockRestante = (typeof prod.stock === "number" ? prod.stock : 0) - cantidadEnCarrito;

      const pStock = existingDiv.querySelector(".stock");
      if (pStock) {
        pStock.textContent = stockRestante > 0 ? `Stock: ${stockRestante}` : "Out of stock";
        pStock.style.color = stockRestante > 0 ? "gray" : "red";
      }

      const pPrice = existingDiv.querySelector(".price");
      if (pPrice) pPrice.textContent = "$" + (prod.price ?? 0);

      const btn = existingDiv.querySelector(".agregar-carrito");
      if (btn) {
        btn.disabled = stockRestante <= 0;
        btn.textContent = stockRestante > 0
          ? (cantidadEnCarrito ? `Add (${cantidadEnCarrito})` : "Add")
          : "Out of stock";
      }

      const mainImg = existingDiv.querySelector(".main-img");
      if (mainImg && prod.imagenes?.length) mainImg.src = prod.imagenes[0];

    } else {
      // nuevo producto ‚Üí render
      renderProductos([up], window.scrollY);
    }
  });

  if (cartCountEl) {
    cartCountEl.textContent = carrito.reduce((acc, i) => acc + i.quantity, 0);
  }
});



});
</script>


</body>
</html>